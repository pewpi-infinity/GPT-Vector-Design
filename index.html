<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Infinity Portal ¬∑ All-In-One System</title>
  <style>
    /* === MERGED MODERN CSS STYLES === */
    * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
    }
    :root {
        --primary-color: #6786df; /* Adjusted for existing buttons */
        --secondary-color: #3546b0;
        --background-dark: #171531; /* Darkest background */
        --background-light: #202a67; /* Card/Panel background */
        --text-primary: #e0f2fe;
        --text-secondary: #b5daf8;
        --accent-color: #50e2a0; /* Main accent green */
        --success-color: #50e2a0;
        --error-color: #ff7892;
        --border-color: #333;
        --panel-shadow: 0 6px 32px rgba(39, 41, 65, 0.4);
    }
    body{
        font-family:"Segoe UI",ui-sans-serif,system-ui;
        background:linear-gradient(135deg,var(--background-dark) 0%,var(--secondary-color) 100%);
        min-height:100vh;
        color:var(--text-primary);
        padding: 20px;
    }
    .panel{
        max-width:900px;
        margin:5vh auto 0;
        background:var(--background-light);
        border-radius:23px;
        box-shadow:var(--panel-shadow);
        padding:2.5em;
        display:none;
        border: 1px solid rgba(103, 134, 223, 0.2);
        animation: fadeIn 0.4s ease-out;
    }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    .show{display:block;}
    h1{
        font-size:2.2em;
        margin:0 0 1.2em 0;
        text-align:center;
        background:linear-gradient(90deg,var(--accent-color),var(--primary-color));
        -webkit-background-clip:text;
        -webkit-text-fill-color:transparent;
        font-weight: 800;
    }
    label{display:block;margin-top:1.16em;font-weight:600;color:var(--text-secondary);text-align:left;}
    input[type="text"],input[type="password"],input[type="email"],textarea{
        width:100%;font-size:1.09em;padding:0.72em;margin-top:0.08em;
        border-radius:8px;border:1px solid var(--border-color);
        background:#181a29;color:#fff;box-sizing:border-box;
    }
    button{
        margin-top:1.05em;width:96%;padding:0.89em 0;font-size:1.13em;
        font-weight:bold;background:linear-gradient(90deg,var(--accent-color),var(--primary-color));
        color:#fff;border:none;border-radius:12px;
        box-shadow:0 1px 7px rgba(80, 226, 160, 0.27);cursor:pointer;transition:.2s;
    }
    button:hover{opacity:0.9;}
    .error-msg{color:var(--error-color);font-size:1em;margin-bottom:0.5em;}
    nav{display:flex;justify-content:center;gap:10px;margin-top:18px;flex-wrap: wrap;}
    .nav-btn{
        background:#222b5a;padding:10px 18px;color:var(--text-primary);
        font-size:1em;border:none;border-radius:10px;box-shadow:0 1.5px 8px rgba(45, 176, 176, 0.07);
        cursor:pointer;transition:.2s;
    }
    .nav-btn.active{background:var(--accent-color);color:#121c28;font-weight: 700;}
    .card{
        background:rgba(0, 0, 0, 0.2);
        color:#fff;border-radius:15px;padding:1.5em;margin:1.5em 0;
        box-shadow:0 2px 9px rgba(48, 94, 214, 0.53);
    }
    .card h2 { color: var(--accent-color); margin-bottom: 0.5em; font-size: 1.5em;}
    .repo-list{margin-top:14px;font-size:1em;}
    .repo-badge{
        background:#753aeb;color:#fff;padding:7px 15px;border-radius:10px;
        margin:0 7px 8px 0;display:inline-block;transition:.2s;
    }
    .repo-badge:hover { opacity: 0.8; }
    .bot-list{margin:1em 0; display: flex; flex-wrap: wrap; gap: 10px;}
    .bot-bubble{
        background:var(--accent-color);color:#121c28;border-radius:14px;
        display:inline-block;padding:0.9em 1.2em;font-weight:600;
        box-shadow:0 2px 8px rgba(80, 226, 160, 0.27);
    }
    .vault-list{margin:1.5em 0;}
    .vault-item{
        background:#7432e2;color:#fff;padding:14px 20px;border-radius:9px;
        margin:8px 0;font-size:1.04em;
        word-break: break-all;
    }
    .admin-actions{margin-top:16px; display: flex; flex-wrap: wrap; gap: 10px;}
    .admin-btn{
        background:#e050b8;padding:11px 20px;color:#fff;font-weight:700;
        border:none;border-radius:9px;font-size:1.0em;margin:0;cursor:pointer;
        width: auto;
    }
    .logout{
        background:#f44f91;color:#fff;padding:9px 19px;border-radius:10px;
        margin-top:21px;font-size:1em;font-weight:700;
        width: auto;
    }
    /* Specific styles for Kris's Admin status */
    .admin-status { color: #50e2a0; font-weight: 700; }
  </style>
</head>
<body>

<div class="panel show" id="loginPanel">
  <h1>Infinity Portal Login</h1>
  <form id="loginForm" autocomplete="off">
    <div class="error-msg" id="errorMsg"></div>
    <label for="username">Username:</label>
    <input type="text" id="username" autocomplete="off"/>
    <label for="password">Password:</label>
    <input type="password" id="password" autocomplete="off"/>
    <label for="email">Email:</label>
    <input type="email" id="email" autocomplete="off"/>
    <button type="submit">Sign In</button>
  </form>
  <div class="card" style="margin-top: 30px; font-size: 0.9em; padding: 1em;">
    <p>üí° **Admin Credentials:** Use **Kris** / any **4+ char password** / **marvaseater@gmail.com**</p>
    <p>Standard users only need a valid email and 6+ char password.</p>
  </div>
</div>

<div class="panel" id="dashboardPanel">
  <h1>Dashboard</h1>
  <nav id="dashboardNav">
    </nav>
  <div class="card">
    <h2>Welcome, <span id="dashUser"></span>! <span id="adminBadge" class="admin-status"></span></h2>
    <p>Session status: <span id="dashStatus" class="admin-status">Active</span></p>
    <div class="repo-list" id="repoList"></div>
  </div>
</div>

<div class="panel" id="portalPanel">
  <h1>Portal & Bot Farm</h1>
  <nav id="portalNav">
    </nav>
  <div class="card">
    <h2>Bot Farm</h2>
    <p>Last 12 bot actions:</p>
    <div class="bot-list" id="botList"></div>
    <div style="display: flex; flex-wrap: wrap; gap: 10px; margin-top: 20px;">
        <button onclick="spawnBot('Cleaner')">üßπ Cleaner Bot</button>
        <button onclick="spawnBot('Syncer')">üîÑ Syncer Bot</button>
        <button onclick="spawnBot('ScriptRunner')">‚ö° ScriptRunner</button>
        <button onclick="spawnBot('ErrorBot')">‚ö†Ô∏è ErrorBot</button>
    </div>
  </div>
</div>

<div class="panel" id="adminPanel">
  <h1>Admin Room</h1>
  <nav id="adminNav">
    </nav>
  <div class="card">
    <h2>Admin Actions & Bot Control</h2>
    <p>WARNING: These actions affect all local session data.</p>
    <div class="admin-actions">
      <button class="admin-btn" onclick="resetBots()">Reset All Bots</button>
      <button class="admin-btn" onclick="clearVault()">Clear Vault</button>
      <button class="admin-btn" onclick="resetSession()">Reset Session Data (Logout)</button>
      <button class="admin-btn" onclick="simulateAdminCommit()">Simulate Commit/Build Script</button>
    </div>
    <p style="margin-top: 15px; color: var(--text-secondary);">Simulated actions trigger client-side changes only.</p>
  </div>
</div>

<div class="panel" id="vaultPanel">
  <h1>Vault / Secret Store</h1>
  <nav id="vaultNav">
    </nav>
  <div class="card">
    <h2>Secrets (PATs, API Keys, Bot Passwords)</h2>
    <p>Stored data is **hidden** and saved only in your browser's session storage (local).</p>
    <div>
      <form id="vaultForm">
        <label for="vaultKey">Name (ex: github_pat, openai_key):</label>
        <input type="text" id="vaultKey" autocomplete="off"/>
        <label for="vaultValue">Value (the secret):</label>
        <textarea id="vaultValue"></textarea>
        <button type="submit">Store Secret</button>
      </form>
    </div>
    <div class="vault-list" id="vaultList"></div>
  </div>
</div>

<script>
let currentPanel = 'login', 
    sessionInfo = null, 
    bots = [], 
    botID = 1001, 
    vault = {};

// --- Configuration and Data ---
const ADMIN_USER = "Kris";
const ADMIN_EMAIL = "marvaseater@gmail.com";
const infinityRepos = [
  {name:"infinity-portal"}, {name:"Vector"}, {name:"Utopia"}, {name:"Vector-API"}, {name:"Infinity-"}, {name:"Joe"}, {name:"GPT-Vector-Design"}
];

// --- Navigation and Session ---
const NAV_BUTTONS = `
    <button class="nav-btn" onclick="switchPanel('dashboard')">Dashboard</button>
    <button class="nav-btn" onclick="switchPanel('portal')">Portal</button>
    <button class="nav-btn" onclick="switchPanel('admin')">Admin</button>
    <button class="nav-btn" onclick="switchPanel('vault')">Vault</button>
    <button class="logout" onclick="logOut()">Log Out</button>
`;

function switchPanel(panel){
    // Update active class for all navs
    document.querySelectorAll('.nav-btn').forEach(btn => btn.classList.remove('active'));
    document.querySelector(`#${panel}Nav .nav-btn[onclick*="'${panel}'"]`).classList.add('active');

    document.getElementById("loginPanel").classList.remove('show');
    document.getElementById("dashboardPanel").classList.remove('show');
    document.getElementById("portalPanel").classList.remove('show');
    document.getElementById("adminPanel").classList.remove('show');
    document.getElementById("vaultPanel").classList.remove('show');
    
    document.getElementById(panel + 'Panel').classList.add('show');
    drawPanel(panel);
}

function populateNavs(activePanel) {
    document.getElementById('dashboardNav').innerHTML = NAV_BUTTONS.replace(`onclick="switchPanel('${activePanel}')"`, `onclick="switchPanel('${activePanel}')" class="active"`);
    document.getElementById('portalNav').innerHTML = NAV_BUTTONS.replace(`onclick="switchPanel('${activePanel}')"`, `onclick="switchPanel('${activePanel}')" class="active"`);
    document.getElementById('adminNav').innerHTML = NAV_BUTTONS.replace(`onclick="switchPanel('${activePanel}')"`, `onclick="switchPanel('${activePanel}')" class="active"`);
    document.getElementById('vaultNav').innerHTML = NAV_BUTTONS.replace(`onclick="switchPanel('${activePanel}')"`, `onclick="switchPanel('${activePanel}')" class="active"`);
}


function storeSession(){ sessionStorage.setItem("infinitySession",JSON.stringify(sessionInfo)); }
function loadSession(){
  let dat = sessionStorage.getItem("infinitySession");
  if(dat){ sessionInfo = JSON.parse(dat);}
}
function clearSession(){ sessionInfo = null; sessionStorage.removeItem("infinitySession"); }
function resetSession(){ clearSession(); vault={}; bots=[]; storeVault(); storeBots(); switchPanel('login'); }
function logOut(){ resetSession(); }

function drawPanel(panel){
  if(sessionInfo.isAdmin) {
      document.getElementById("adminBadge").textContent = "(ADMIN)";
  } else {
      document.getElementById("adminBadge").textContent = "";
  }
  
  if(panel==='dashboard'){
    document.getElementById("dashUser").textContent = sessionInfo ? sessionInfo.username : "";
    document.getElementById("dashStatus").textContent = sessionInfo ? "SECURE" : "Unknown";
    showRepos();
  }
  if(panel==='portal'){ renderBots();}
  if(panel==='vault'){ renderVault();}
}

// --- Login Logic (Combined) ---
document.getElementById("loginForm").addEventListener("submit",function(e){
  e.preventDefault();
  const username = document.getElementById("username").value.trim(),
        password = document.getElementById("password").value,
        email = document.getElementById("email").value.trim(),
        errorMsg = document.getElementById("errorMsg");
        
  errorMsg.textContent = "";

  // Check for Kris Admin Access
  const isKrisAdmin = (username === ADMIN_USER && password.length >= 4 && email === ADMIN_EMAIL);
  // Check for Standard User Access
  const isStandardUser = (password.length >= 6 && /\S+@\S+\.\S+/.test(email));

  if (isKrisAdmin || isStandardUser) {
    sessionInfo = {
        username,
        email,
        loginTime: Date.now(),
        isAdmin: isKrisAdmin // Set admin flag
    };
    storeSession();
    populateNavs('dashboard'); // Initialize navs
    switchPanel('dashboard');
  } else {
    errorMsg.textContent = "Invalid credentials. Admin requires specific fields; others need 6+ char password & valid email.";
  }
});

function showRepos(){
  let html = "Repos:&nbsp;"+infinityRepos.map(repo=>`<span class="repo-badge"><a href="https://github.com/pewpi-infinity/${repo.name}" target="_blank" style="color:#fff;text-decoration:none;">${repo.name}</a></span>`).join('');
  document.getElementById("repoList").innerHTML = html;
}

// --- Admin Simulation Action ---
function simulateAdminCommit() {
    if (!sessionInfo.isAdmin) {
        alert("Access Denied: Only Kris (ADMIN) can run this simulated action.");
        return;
    }
    // *SECURITY NOTE: This is a safe client-side simulation.
    // The original code's fetch() call to a backend has been removed to comply with safety guidelines.*
    alert(`ADMIN ACTION SIMULATED: Build script triggered for data lookup and commit by ${sessionInfo.username}. (No actual backend comms occurred.)`);
    document.getElementById("dashStatus").textContent = "BUILDING...";
    setTimeout(() => {
        document.getElementById("dashStatus").textContent = "SECURE";
        drawPanel('dashboard'); // Redraw to update status
    }, 2000);
}


// --- Bot farm logic ---
function storeBots(){ sessionStorage.setItem("infinityBots",JSON.stringify(bots)); }
function loadBots(){ let dat=sessionStorage.getItem("infinityBots"); if(dat)bots=JSON.parse(dat); }
function resetBots(){ bots=[]; storeBots(); renderBots(); alert("All bots reset."); }
function spawnBot(type){
  botID++;
  let bot = {id:botID,type,status:"Busy",created:Date.now(),log:[]};
  setTimeout(()=>{ 
    bot.status="Done"; 
    bot.log.push(type+" complete at "+new Date().toLocaleTimeString());
    storeBots();
    renderBots();
    if(type === 'ErrorBot') alert(`‚ö†Ô∏è ErrorBot ID:${bot.id} finished with simulated error.`);
  }, 650 + Math.random() * 1050); // Randomize completion time
  bots.push(bot);storeBots();renderBots();
}
function renderBots(){
  loadBots();
  let html = "";
  bots.slice(-12).forEach(bot => {
    html += `<span class="bot-bubble">${bot.type} Bot (ID:${bot.id})<br>Status: <span style="color:${bot.status==='Done'?"#121c28":"#ffd43b"}">${bot.status}</span></span>`;
  });
  document.getElementById("botList").innerHTML = html || "<i>No bots running.</i>";
}

// --- Vault logic ---
function storeVault(){ sessionStorage.setItem("infinityVault",JSON.stringify(vault)); }
function loadVault(){ let dat=sessionStorage.getItem("infinityVault"); if(dat)vault=JSON.parse(dat); }
function clearVault(){ vault={}; storeVault();renderVault(); alert("Vault cleared."); }
document.getElementById("vaultForm").addEventListener("submit",function(e){
  e.preventDefault();
  const k = document.getElementById("vaultKey").value.trim(),
        v = document.getElementById("vaultValue").value.trim();
  if(!k||!v){alert("Key and Value cannot be empty."); return;}
  vault[k]=v; storeVault(); renderVault();
  document.getElementById("vaultKey").value="";
  document.getElementById("vaultValue").value="";
  alert(`Secret "${k}" stored successfully.`);
});
function renderVault(){
  loadVault();
  let html="";
  for(const k in vault){
    html+=`<div class="vault-item"><b>${k}:</b><br>${vault[k].replace(/./g,"‚Ä¢")}</div>`;
  }
  document.getElementById("vaultList").innerHTML = html || "<i>No secrets stored.</i>";
}

// --- Initial load ---
(function(){
  loadSession(); loadBots(); loadVault();
  if(sessionInfo) {
    populateNavs('dashboard');
    switchPanel('dashboard');
  } else {
    populateNavs('login');
  }
})();
</script>
</body>
</html>

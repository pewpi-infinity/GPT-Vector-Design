<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Rogers — Static Test UI (no backend)</title>
  <style>
    body{font-family:system-ui,Segoe UI,Roboto,Arial;margin:18px;max-width:980px}
    h1{margin:0 0 8px 0}
    #chat{border:1px solid #ddd;padding:12px;min-height:200px;background:#fafafa;white-space:pre-wrap}
    .row{display:flex;gap:8px;margin-top:10px}
    input[type=text]{flex:1;padding:8px}
    button{padding:8px 12px}
    .meta{font-size:0.9rem;color:#666;margin-top:8px}
    .err{color:#b00;font-weight:600}
    .note{color:#066}
    pre.code{background:#111;color:#eee;padding:10px;overflow:auto;max-height:400px}
  </style>
</head>
<body>
  <h1>Rogers — Static UI (no backend)</h1>
  <div class="meta">
    This is a static fallback page. It cannot run Python logic in your repo — it can fetch files from public GitHub repositories.
  </div>

  <div id="chat" aria-live="polite"></div>

  <div class="row">
    <input id="query" type="text" placeholder="Type a command (e.g. 'hello' or 'fetch github owner repo path [ref]')" />
    <button id="send">Send</button>
    <button id="clear">Clear</button>
  </div>

  <div style="margin-top:12px">
    <label class="note">Fetch GitHub example:</label>
    <div class="row">
      <input id="gh_owner" type="text" placeholder="owner (e.g. octocat)" />
      <input id="gh_repo" type="text" placeholder="repo (e.g. Hello-World)" />
      <input id="gh_path" type="text" placeholder="path (README.md or src/file.py)" />
      <input id="gh_ref" type="text" placeholder="ref (branch/commit - optional)" />
      <button id="gh_fetch">Fetch</button>
    </div>
    <div class="meta">Public repos only: uses raw.githubusercontent.com or the API for content. Private repos require a token (not safe to embed in a public page).</div>
  </div>

  <script>
    // Utility: append lines to the chat box
    const chat = document.getElementById('chat');
    function appendUser(msg){ chat.innerHTML += '<div><strong>You:</strong> '+escapeHtml(msg)+'</div>'; chat.scrollTop = chat.scrollHeight; }
    function appendBot(msg){ chat.innerHTML += '<div><strong>Result:</strong> '+escapeHtml(msg)+'</div>'; chat.scrollTop = chat.scrollHeight; }
    function appendHtml(html){ chat.innerHTML += html; chat.scrollTop = chat.scrollHeight; }
    function escapeHtml(s){ return String(s).replace(/[&<>"]/g, c => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;'}[c])); }

    async function fetchGithubFile(owner, repo, path, ref){
      // Try raw.githubusercontent first with a guessed branch
      // If ref provided, use it. If not, try common default branches.
      const candidates = ref ? [ref] : ['main','master'];
      for(const r of candidates){
        const rawUrl = `https://raw.githubusercontent.com/${owner}/${repo}/${r}/${path}`;
        try {
          const res = await fetch(rawUrl);
          if(res.ok){
            const text = await res.text();
            return { ok:true, source: rawUrl, text };
          }
        } catch(e){
          // continue to API fallback
        }
      }
      // Fallback: use GitHub contents API (returns JSON unless header Accept: 'application/vnd.github.v3.raw' used)
      // We try without auth; this works for public repos.
      const apiRef = ref ? `?ref=${encodeURIComponent(ref)}` : '';
      const apiUrl = `https://api.github.com/repos/${owner}/${repo}/contents/${path}${apiRef}`;
      try {
        const res = await fetch(apiUrl, { headers: { 'Accept': 'application/vnd.github.v3.raw' } });
        if(res.ok){
          const text = await res.text();
          return { ok:true, source: apiUrl, text };
        } else {
          const errText = await res.text();
          return { ok:false, error: `GitHub API ${res.status}: ${errText}` };
        }
      } catch(e){
        return { ok:false, error: e.toString() };
      }
    }

    async function handleQuery(q){
      q = (q||'').trim();
      appendUser(q);
      if(!q){ appendBot('Type a command, eg "fetch github owner repo path"'); return; }

      // If begins with "fetch github", parse and fetch
      const fetchMatch = /^fetch\s+github\s+([^\s\/]+)\s+([^\s\/]+)\s+([^\s].*?)(?:\s+([^\s]+))?$/i.exec(q);
      if(fetchMatch){
        const owner = fetchMatch[1];
        const repo = fetchMatch[2];
        const path = fetchMatch[3];
        const ref = fetchMatch[4] || '';
        appendBot(`Fetching ${owner}/${repo}/${path} ${ref ? 'ref:'+ref : ''} ...`);
        const res = await fetchGithubFile(owner, repo, path, ref);
        if(res.ok){
          // Show source and code block
          appendHtml(`<div style="margin-top:10px"><div><em>Fetched from: ${escapeHtml(res.source)}</em></div><pre class="code">${escapeHtml(res.text)}</pre></div>`);
        } else {
          appendBot('Error fetching: ' + res.error);
        }
        return;
      }

      // Otherwise simple static fallback "no backend"
      appendBot('No backend available in this static page. Two options:\n - Run the rogers helper (Python) on a server and let index.html call it (recommended)\n - Use "fetch github <owner> <repo> <path> [ref]" to retrieve files from GitHub (public repos).');
    }

    document.getElementById('send').addEventListener('click', ()=> {
      const q = document.getElementById('query').value;
      handleQuery(q);
    });
    document.getElementById('clear').addEventListener('click', ()=> { document.getElementById('query').value=''; chat.innerHTML=''; });
    document.getElementById('query').addEventListener('keydown', (e)=> { if(e.key==='Enter'){ e.preventDefault(); document.getElementById('send').click(); } });

    document.getElementById('gh_fetch').addEventListener('click', ()=> {
      const owner = document.getElementById('gh_owner').value.trim();
      const repo = document.getElementById('gh_repo').value.trim();
      const path = document.getElementById('gh_path').value.trim();
      const ref  = document.getElementById('gh_ref').value.trim();
      if(!owner || !repo || !path){ alert('owner, repo and path required'); return; }
      const cmd = ['fetch','github',owner,repo,path].concat(ref ? [ref] : []).join(' ');
      document.getElementById('query').value = cmd;
      handleQuery(cmd);
    });

    // show short help on load
    appendBot('Static fallback loaded. Type "fetch github owner repo path [ref]" to fetch a file from GitHub (public repos).');
  </script>
</body>
</html>